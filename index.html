<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">

  <!-- ‚òÖ „É¢„Éê„Ç§„É´„ÅÆÂè§„ÅÑHTML„Ç≠„É£„ÉÉ„Ç∑„É•ÂØæÁ≠ñÔºàÂäπ„ÅèÁØÑÂõ≤„ÅßÔºâ -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <meta name="theme-color" content="#ffb744">
  <title>Èõ≤‰∏π„Çê„Åè„ÇâÊ≠åÂî±Êõ≤DB</title>

  <!-- favicon „ÇíÊòéÁ§∫Ôºà404ÊäëÊ≠¢Ôºâ -->
  <link rel="icon" sizes="any"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3Eüç£%3C/text%3E%3C/svg%3E">

  <!-- „É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÊäëÊ≠¢ÔºöÊúÄÂàù„Åã„Çâ /macros/s/ „Çí‰Ωø„ÅÜ„ÄÇÈÄüÂ∫¶ÂØæÁ≠ñÔºöDNS/Preconnect -->
  <link rel="dns-prefetch" href="https://script.google.com">
  <link rel="preconnect" href="https://script.google.com" crossorigin>

  <style>
    :root{
      --bg:#ffb744; --card:#ffffff; --text:#1a1a1a; --muted:#6b7280; --line:#e5e7eb;
      --thead:#ffe0b5; --focus:#3897c9; --chip-bg:#f3f4f6; --chip-text:#111827;
      --link:#2563eb; --pill-bg:#f6f7f9;
    }
    *{box-sizing:border-box}
    body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;line-height:1.7;margin:12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .row{display:flex;gap:8px;align-items:center}
    .row .search{flex:1 1 auto;min-width:0}
    .toolbar{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-top:8px;flex-wrap:wrap}
    .limit-wrap{display:flex;align-items:center;gap:6px}
    .limit-wrap label,.dm-group label{font-size:12px;color:var(--muted);white-space:nowrap}
    #limit{width:auto;min-width:68px;padding:6px 8px;font-size:13px;line-height:1.2}
    .dm-group{display:flex;align-items:center;gap:6px;margin-left:auto}
    #dm-select{width:auto;min-width:84px;padding:6px 8px;font-size:14px;line-height:1.2}
    .dm-group .btn{padding:6px 10px;font-size:13px;white-space:nowrap}
    input[type="search"],select{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;font-size:15px;background:#fff;color:var(--text);outline:none}
    input[type="search"]:focus,select:focus,.btn:focus,.btn-pill:focus{outline:3px solid var(--focus);outline-offset:2px}
    .muted{color:var(--muted);font-size:13px}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;color:var(--text);border-radius:10px;padding:8px 12px;font-size:14px;cursor:pointer}
    .btn:hover{background:#f9fafb}.btn:active{transform:translateY(1px)}
    .toast{position:fixed;left:50%;bottom:16px;transform:translateX(-50%);background:rgba(17,24,39,.92);color:#fff;padding:10px 14px;border-radius:10px;font-size:14px;opacity:0;transition:opacity .2s}
    .toast.show{opacity:1}
    table{width:100%;border-collapse:collapse;margin-top:10px;table-layout:fixed}
    th,td{border-bottom:1px solid var(--line);padding:10px 8px;font-size:15px;vertical-align:top}
    th{position:sticky;top:0;background:var(--thead);z-index:1;font-weight:700}
    th:nth-child(1),td:nth-child(1){width:30%}
    th:nth-child(2),td:nth-child(2){width:50%}
    th:nth-child(3),td:nth-child(3){width:20%}
    .ops{display:flex;align-items:center;justify-content:flex-end;gap:8px;flex-wrap:wrap}
    @media (max-width:768px){
      table{display:none}
      .mobile-list{display:block;margin-top:10px}
      .item{border-bottom:1px solid var(--line);padding:12px 2px;display:flex;flex-direction:column;gap:6px}
      .l1{font-size:16px;line-height:1.6;font-weight:700;display:flex;gap:6px;flex-wrap:wrap}
      .l1 .sep{opacity:.6}
      .l2{display:flex;align-items:center;gap:8px;justify-content:flex-end;flex-wrap:wrap}
      .btn{padding:8px 12px;font-size:14px}
    }
    .btn-pill{
      display:inline-block;border:1px solid var(--line);background:var(--pill-bg);color:var(--link);
      border-radius:10px;padding:8px 12px;font-size:14px;line-height:1.2;text-decoration:none;
      white-space:nowrap;max-width:320px;overflow:hidden;text-overflow:ellipsis
    }
    .btn-pill:hover{background:#eef2f7;text-decoration:none}
    .btn-pill:active{transform:translateY(1px)}
    .ops .btn-pill, .ops .btn, .l2 .btn-pill, .l2 .btn { font-size:11pt; }
  </style>
</head>
<body>

  <!-- Ê§úÁ¥¢UI -->
  <div class="card">
    <div class="row">
      <input class="search" id="q" type="search" placeholder="Êõ≤ÂêçÔºè„Ç¢„Éº„ÉÜ„Ç£„Çπ„ÉàÂêç„ÅßÊ§úÁ¥¢" autocomplete="off">
    </div>

    <div class="toolbar">
      <div class="limit-wrap">
        <label for="limit">‰ª∂Êï∞</label>
        <select id="limit" aria-label="Ë°®Á§∫‰ª∂Êï∞">
          <option value="20" selected>20‰ª∂</option>
          <option value="50">50‰ª∂</option>
          <option value="200">200‰ª∂</option>
          <option value="all">ÂÖ®‰ª∂</option>
        </select>
      </div>

      <div class="dm-group" aria-label="ÂºæÂπï„Ç≥„Éî„Éº">
        <label for="dm-select">ÂºæÂπï</label>
        <select id="dm-select" title="ÂºæÂπï„ÇíÈÅ∏Êäû">
          <option value="üç£üß°üç£üß°üç£üß°">üç£üß°üç£</option>
          <option value="üç£üß°üé∂üç£üß°üé∂">üç£üß°üé∂</option>
        </select>
        <button id="dm-copy" class="btn" type="button" title="ÈÅ∏Êäû„Åó„ÅüÂºæÂπï„Çí„Ç≥„Éî„Éº">„Ç≥„Éî„Éº</button>
      </div>
    </div>

    <div class="muted" id="status">Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶</div>
  </div>

  <!-- ÁµêÊûúË°®Á§∫ -->
  <div class="card" style="margin-top:12px;">
    <div class="muted" id="hint">Ê§úÁ¥¢ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ</div>
    <div id="table"></div>
    <div id="mblist" class="mobile-list" style="display:none;"></div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü</div>

  <script>
    /* ===== Ë®≠ÂÆö ===== */
    const BASE = 'https://script.google.com/macros/s/AKfycbwJuhqH3pF5_465zPSeagKuIwUX7rlFy2nMCLMSAiuCpQ2OOIzGVIlH41G7F3gHdHYQhg/exec';
    const SHEET_KEY = 'perf';           // GASÂÅ¥„Åß "Performance Record" „Å´Ëß£Ê±∫
    const INITIAL_FETCH = 200;
    const HARD_LIMIT = 20000;

    // ‚òÖ iOSÁ≥ªÂà§ÂÆöÔºà„Éà„É©„ÉÉ„ÇØ„Éë„ÉÉ„Éâ‰ªò„ÅçMac„ÅÆË™§Ê§úÂá∫„ÇíÈÅø„Åë„ÇãÁ∞°ÊòìÁâàÔºâ
    const isIOS = /iP(hone|ad|od)/.test(navigator.userAgent) || 
                  (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);

    // „Çø„Ç§„É†„Ç¢„Ç¶„Éà„Å®„Éò„ÉÉ„Ç∏Ëµ∑ÂãïÔºà‚òÖiOSÂêë„Åë„Å´ÂæÆË™øÊï¥Ôºâ
    const JSONP_TIMEOUT_MS = 6500;
    const IFRAME_KICK_MS   = 400;
    const IFRAME_TIMEOUT_MS = 15000;

    // iframe -> parent „ÅÆ postMessage ÈÄÅ‰ø°ÂÖÉÊ§úË®º
    const ORIGIN_ALLOW_RE = /(^https:\/\/[a-z0-9.-]+\.google\.com$)|(^https:\/\/script\.google\.com$)/i;

    /* ===== Áä∂ÊÖã ===== */
    const state = {
      rows: [],
      total: 0,
      debounce: null,
      delivered: false,
      usedIframe: false,
      jsonpTimer: null,
      iframeTimer: null,
      source: '' // 'jsonp' | 'iframe'
    };

    /* ===== „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ ===== */
    const $ = id => document.getElementById(id);
    const normalize = s => (s||'').toString().toLowerCase().replace(/\s+/g,' ').trim();
    function scheduleSearch(){ clearTimeout(state.debounce); state.debounce = setTimeout(render, 160); }
    function showToast(msg){ const t=$('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1400); }

    // ÊñáÂ≠óÂàó„ÅåURL„Çâ„Åó„ÅÑ„Åã„ÅÆÁ∞°ÊòìÂà§ÂÆö
    const looksUrl = s => /^https?:\/\//i.test(String(s||''));

    async function copyPair(title, artist){
      const text = `${(title||'').trim()} / ${(artist||'').trim()}`.trim();
      try{
        if(navigator.clipboard?.writeText) await navigator.clipboard.writeText(text);
        else { const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); }
        showToast('„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºö' + text);
      }catch{ showToast('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'); }
    }
    $('dm-copy').addEventListener('click', async ()=>{
      const text = $('dm-select').value || '';
      try{
        if(navigator.clipboard?.writeText) await navigator.clipboard.writeText(text);
        else { const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); }
        showToast('ÂºæÂπï„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü');
      }catch{ showToast('ÂºæÂπï„ÅÆ„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'); }
    });
    const urlFromText = s => { if(!s) return ''; const m=String(s).match(/https?:\/\/\S+/); return m ? m[0].replace(/[)\]\s]+$/,'') : ''; };
    const formatYmdLabel = s => { const m=/^(\d{4})(\d{2})(\d{2})/.exec(String(s||'')); return m ? `${m[1]}/${m[2]}/${m[3]}` : null; };

    /* ===== Âèó‰ø°Âè£ÔºàJSONP/iframe ÂÖ±ÈÄöÔºâ ===== */
    function onGviz(payload){
      if (state.delivered) return;

      clearTimeout(state.jsonpTimer);
      clearTimeout(state.iframeTimer);
      const oldS = document.getElementById('jsonp-tag'); if (oldS) oldS.remove();
      const oldF = document.getElementById('gviz-frame'); if (oldF) oldF.remove();

      try{
        if (!payload || payload.ok === false) {
          $('status').textContent = '„Éá„Éº„ÇøÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';
          return;
        }
        if (!Array.isArray(payload.rows)) {
          $('status').textContent = '„Éá„Éº„ÇøÂΩ¢Âºè„Åå‰∏çÊ≠£„Åß„Åô';
          return;
        }
        state.rows = payload.rows.map(r => [
          r.artist || '', r.title || '', r.cText || '', r.dText || '', r.cUrl || '', r.dUrl || ''
        ]).filter(([a,b]) => ((a||'')+(b||'')).trim() !== '');
        state.total = Number(payload.matched || payload.total || state.rows.length);
        state.delivered = true;

        const tag = state.source ? ` via ${state.source}` : '';
        $('status').textContent = `Ë™≠„ÅøËæº„ÅøÂÆå‰∫ÜÔºö${state.rows.length}‰ª∂ÔºàÂÖ®${state.total}‰ª∂Ôºâ${tag}`;
        render();
      }catch(e){
        console.error(e);
        $('status').textContent = 'Ë™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';
      }
    }
    window.onGviz = onGviz;

    // iframe „Åã„Çâ„ÅÆ postMessage Âèó‰ø°
    window.addEventListener('message', (ev)=>{
      const d = ev?.data;
      if (!d || d.type !== 'gviz') return;
      if (!ORIGIN_ALLOW_RE.test(ev.origin||'')) return;
      state.source = 'iframe';
      onGviz(d.payload);
    });

    /* ===== ÊèèÁîª ===== */
    function render(){
      const tableWrap = $('table'); if (tableWrap) tableWrap.innerHTML = '';
      const listWrap  = $('mblist'); listWrap.innerHTML = '';
      const hint = $('hint');

      const q = normalize($('q').value || '');
      const raw = $('limit').value;
      const limit = raw === 'all'
        ? Math.min(HARD_LIMIT, state.total || state.rows.length)
        : Math.min(parseInt(raw,10)||20, HARD_LIMIT);
      const limitLabel = raw === 'all' ? 'ÂÖ®‰ª∂' : `${limit}‰ª∂`;

      let filtered = state.rows;
      if (q) filtered = filtered.filter(([artist, title]) => normalize(artist).includes(q) || normalize(title).includes(q));
      const rows = filtered.slice(0, limit);

      $('status').textContent = q
        ? `${rows.length}‰ª∂„Éí„ÉÉ„ÉàÔºàÂÖ®${filtered.length}‰ª∂ÔºèÁ∑è${state.total}‰ª∂ÔºâÔºèË°®Á§∫‰∏äÈôê ${limitLabel}`
        : `Ë°®Á§∫‰∏≠ ${rows.length}‰ª∂ÔºàÁ∑è${state.total}‰ª∂ÔºâÔºèË°®Á§∫‰∏äÈôê ${limitLabel}`;

      if (rows.length === 0){ hint.textContent = q ? 'Ë©≤ÂΩì„Å™„Åó' : 'Ê§úÁ¥¢ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ'; return; }
      hint.textContent = '';

      // PC: „ÉÜ„Éº„Éñ„É´
      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const trh = document.createElement('tr');
      ['„Ç¢„Éº„ÉÜ„Ç£„Çπ„ÉàÂêç','Êõ≤Âêç','Êìç‰Ωú'].forEach(h=>{ const th=document.createElement('th'); th.textContent=h; trh.appendChild(th); });
      thead.appendChild(trh); table.appendChild(thead);
      const tbody = document.createElement('tbody');

      rows.forEach(([artist, title, cText, dText, cUrl, dUrl])=>{
        const tr=document.createElement('tr');

        let td=document.createElement('td'); td.textContent=artist||''; tr.appendChild(td);
        td=document.createElement('td'); td.textContent=title||''; tr.appendChild(td);

        const tdOps=document.createElement('td'); const ops=document.createElement('div'); ops.className='ops';

        // URLÂé≥Ê†ºÂØæÁ≠ñÔºöcUrl/dUrl„ÅåURL„Åß„Å™„Åë„Çå„Å∞ cText/dText „Åã„ÇâÊäΩÂá∫
        const cHref = looksUrl(cUrl) ? cUrl : urlFromText(cText);
        if (cHref){ const a=document.createElement('a'); a.href=cHref; a.target='_blank'; a.rel='noopener'; a.className='btn-pill'; a.title=cText||'„É™„É≥„ÇØ'; a.textContent=cText||'„É™„É≥„ÇØ'; ops.appendChild(a); }

        const dHref = looksUrl(dUrl) ? dUrl : urlFromText(dText);
        const dLabel = formatYmdLabel(dText);
        if (dHref){ const a=document.createElement('a'); a.href=dHref; a.target='_blank'; a.rel='noopener'; a.className='btn-pill'; a.title=dLabel?`ÂâçÂõû ${dLabel}`:'ÂâçÂõû'; a.textContent=dLabel?`‚ñ∂ÂâçÂõû${dLabel}`:'‚ñ∂ÂâçÂõû'; ops.appendChild(a); }

        const btn=document.createElement('button'); btn.className='btn'; btn.textContent='„Ç≥„Éî„Éº';
        btn.addEventListener('click',()=>copyPair(title,artist));
        ops.appendChild(btn);

        tdOps.appendChild(ops); tr.appendChild(tdOps); tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      document.getElementById('table').innerHTML = '';
      document.getElementById('table').appendChild(table);

      // „É¢„Éê„Ç§„É´: „Ç´„Éº„Éâ
      rows.forEach(([artist, title, cText, dText, cUrl, dUrl])=>{
        const item=document.createElement('div'); item.className='item';
        const l1=document.createElement('div'); l1.className='l1';
        const a1=document.createElement('span'); a1.className='artist'; a1.textContent=artist||'';
        const sep=document.createElement('span'); sep.className='sep'; sep.textContent='/';
        const t1=document.createElement('span'); t1.className='title'; t1.textContent=title||'';
        l1.appendChild(a1); l1.appendChild(sep); l1.appendChild(t1);
        const l2=document.createElement('div'); l2.className='l2';

        const cHref = looksUrl(cUrl) ? cUrl : urlFromText(cText);
        if (cHref){ const a=document.createElement('a'); a.href=cHref; a.target='_blank'; a.rel='noopener'; a.className='btn-pill'; a.title=cText||'„É™„É≥„ÇØ'; a.textContent=cText||'„É™„É≥„ÇØ'; l2.appendChild(a); }
        const dHref = looksUrl(dUrl) ? dUrl : urlFromText(dText);
        const dLabel = formatYmdLabel(dText);
        if (dHref){ const a=document.createElement('a'); a.href=dHref; a.target='_blank'; a.rel='noopener'; a.className='btn-pill'; a.title=dLabel?`ÂâçÂõû ${dLabel}`:'ÂâçÂõû'; a.textContent=dLabel?`‚ñ∂ÂâçÂõû${dLabel}`:'‚ñ∂ÂâçÂõû'; l2.appendChild(a); }

        const btn=document.createElement('button'); btn.className='btn'; btn.textContent='„Ç≥„Éî„Éº';
        btn.addEventListener('click',()=>copyPair(title,artist));
        l2.appendChild(btn);

        item.appendChild(l1); item.appendChild(l2); document.getElementById('mblist').appendChild(item);
      });

      // ‚òÖ „É¢„Éê„Ç§„É´Áî®„É™„Çπ„Éà„ÅÆ display ÂàáÊõø„ÅØCSS„Å´‰ªª„Åõ„Çã
    }

    /* ===== ÂèñÂæóÔºöJSONP„Å®iframe„ÇíÁ´ØÊú´Âà•„Å´ÊúÄÈÅ©Âåñ ===== */

    // ÈÄöÂ∏∏ÔºàJSONP‚ÜíIFRAMEÔºâ
    function fetchRows(limit){
      state.delivered = false;
      state.usedIframe = false;
      state.source = '';
      $('status').textContent = 'Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶';

      // ÂæåÁâá‰ªò„Åë
      const oldS = document.getElementById('jsonp-tag'); if (oldS) oldS.remove();
      const oldF = document.getElementById('gviz-frame'); if (oldF) oldF.remove();
      clearTimeout(state.jsonpTimer);
      clearTimeout(state.iframeTimer);

      // 1) JSONP „ÇíÊäï„Åí„ÇãÔºàcallbackÂøÖÈ†àÔºâ
      const urlJsonp = `${BASE}?callback=onGviz&sheet=${encodeURIComponent(SHEET_KEY)}&limit=${Math.min(limit,HARD_LIMIT)}&v=${Date.now()}`;
      const s = document.createElement('script');
      s.id = 'jsonp-tag';
      s.src = urlJsonp;
      s.async = true;
      s.onerror = () => { /* iframe „Éò„ÉÉ„Ç∏„Å∏ */ };
      document.head.appendChild(s);

      // 2) IFRAME „ÇíÂ∞ë„ÅóÊó©„ÇÅ„Å´„Ç≠„ÉÉ„ÇØÔºàGASÂÅ¥„Åß frame=1 „ÇíÂèó„Åë„ÇãÔºâ
      setTimeout(() => {
        if (state.delivered) return;
        startIframe(limit);
      }, IFRAME_KICK_MS);

      // 3) JSONP ÊúÄÁµÇ„Çø„Ç§„É†„Ç¢„Ç¶„Éà
      state.jsonpTimer = setTimeout(() => { /* no-op */ }, JSONP_TIMEOUT_MS);
    }

    // iOSÂêë„ÅëÔºöÂÖà„Å´iframe„ÄÅÂæå„Åã„ÇâJSONP„Çí„Éò„ÉÉ„Ç∏
    function fetchRowsIOS(limit){
      state.delivered = false;
      state.usedIframe = false;
      state.source = '';
      $('status').textContent = 'Ë™≠„ÅøËæº„Åø‰∏≠‚Ä¶';

      const oldS = document.getElementById('jsonp-tag'); if (oldS) oldS.remove();
      const oldF = document.getElementById('gviz-frame'); if (oldF) oldF.remove();
      clearTimeout(state.jsonpTimer);
      clearTimeout(state.iframeTimer);

      // ÂÖà„Å´ iframe
      startIframe(limit);

      // 500msÈÅÖ„Çâ„Åõ„Å¶ JSONP „ÇÇËµ∑ÂãïÔºàÂÖàÁùÄÂãù„Å°Ôºâ
      setTimeout(() => {
        if (state.delivered) return;
        const urlJsonp = `${BASE}?callback=onGviz&sheet=${encodeURIComponent(SHEET_KEY)}&limit=${Math.min(limit,HARD_LIMIT)}&v=${Date.now()}`;
        const s = document.createElement('script');
        s.id = 'jsonp-tag';
        s.src = urlJsonp;
        s.async = true;
        s.onerror = () => {};
        document.head.appendChild(s);
        state.jsonpTimer = setTimeout(() => { /* no-op */ }, JSONP_TIMEOUT_MS);
      }, 500);
    }

    function startIframe(limit){
      if (state.usedIframe || state.delivered) return;
      state.usedIframe = true;

      // callback „Å™„ÅóÔºàGASÂÅ¥ frame ÂàÜÂ≤ê„Åß HTML „ÇíËøî„Åï„Åõ„ÇãÔºâ
      const urlFrame = `${BASE}?frame=1&sheet=${encodeURIComponent(SHEET_KEY)}&limit=${Math.min(limit,HARD_LIMIT)}&v=${Date.now()}`;

      const f = document.createElement('iframe');
      f.id = 'gviz-frame';
      f.src = urlFrame;

      // iOSÂØæÁ≠ñÔºödisplay:none „Çí‰Ωø„Çè„Åö„ÄÅÁîªÈù¢Â§ñ„Å´ÈÖçÁΩÆ
      f.style.position = 'absolute';
      f.style.left = '-9999px';
      f.style.top = '-9999px';
      f.width = 1;
      f.height = 1;
      f.tabIndex = -1;

      document.body.appendChild(f);

      clearTimeout(state.iframeTimer);
      state.iframeTimer = setTimeout(() => {
        if (!state.delivered){
          $('status').textContent = 'ÂèñÂæó„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„ÅüÔºàÂÖ¨ÈñãË®≠ÂÆö/„Éá„Éó„É≠„Ç§Á¢∫Ë™ç/ÂõûÁ∑öÁä∂ÊÖãÔºâ';
        }
      }, IFRAME_TIMEOUT_MS);
    }

    // ÂàùÂõû„É≠„Éº„ÉâÔºàiOS„ÅØiframeÂÖàË°å„ÄÅ„Åù„ÅÆ‰ªñ„ÅØJSONPÂÖàË°åÔºâ
    document.addEventListener('DOMContentLoaded', ()=>{
      if (isIOS) {
        fetchRowsIOS(INITIAL_FETCH);
      } else {
        fetchRows(INITIAL_FETCH);
      }
    });

    // „Ç§„Éô„É≥„Éà
    $('q').addEventListener('input', scheduleSearch);
    $('limit').addEventListener('change', ()=>{ render(); });
  </script>
</body>
</html>
